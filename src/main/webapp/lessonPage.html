<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>課程首頁</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <style>
        * {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        body{
        	background-color: rgb(249, 251, 253);
        }

        .main {
            display: flex;
            margin-left: 13%;
            width: 87%;
            background-color: rgb(249, 251, 253);
            padding: 0 50px;
        }

        .nav>ul>li>a {
            text-decoration: none;
            color: gray;
            transition: .5s;
        }

        .nav>ul>li>a:hover,
        .nav>ul>li>a:focus {
            color: black;
        }

        .navTutor {
        	position: fixed;
        	top: 0;
        	left:0;
            width: 13%;
            background-color: #fff;
            height: 100vh;
            justify-items: center;
            align-items: center;
            box-shadow: 0 0 10px 15px #f5f3f4;
        }

        .navTutor>ul>li {
            text-decoration: none;
            color: gray;
            padding: 10px;
            padding-left: 30px;
        }


        .iconCard {
            display: flex;
            justify-items: center;
            align-items: center;
            margin: 20px 0;
        }

        .iconImg {
            margin: 0 auto;
            width: 40%;

        }

        .container {
            width: 87%;
            background-color: rgb(249, 251, 253);
            padding: 0 50px;
        }

        .container h2 {
            border-bottom: 1px solid #edede9;
            padding: 30px 0;
        }

        .favorite {
            width: 100%;
            margin: 0 auto;
        }

        .favoriteTable {
        	display: block;
            margin-top: 40px;
            margin-bottom:30px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 5px 1px #f5f3f4;
            padding: 5px 0;
        }

        .favoriteTableHeader {
        	display:flex;
        	padding:15px 25px;
            justify-content: spacebetween;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        .tableHead {
            background-color: rgb(249, 251, 253);
        }

        th,
        td {
            padding: 15px 25px;
            text-align: center;
        }

        tr {
            border-top: 1px solid #edede9;
        }

        th:first-child,
        td:first-child {
            text-align: left
        }
    </style>
</head>

<body>
        <div class="navTutor">
            <div class="iconCard">
                <div class="iconImg">
                <img src="https://raw.githubusercontent.com/uu890817/TutorLink/e85cd3edeba7a6198276171af9e994154cb89ba0/assets/images/logo/TutorLinkLogo.svg"
                        alt=""></div>
            </div>
            <ul>
                <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-person" viewBox="0 0 16 16">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z" />
                        </svg> 使用者管理</a></li>
                <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-journals" viewBox="0 0 16 16">
                            <path
                                d="M5 0h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2 2 2 0 0 1-2 2H3a2 2 0 0 1-2-2h1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1H1a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v9a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1H3a2 2 0 0 1 2-2z" />
                            <path
                                d="M1 6v-.5a.5.5 0 0 1 1 0V6h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V9h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 2.5v.5H.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1H2v-.5a.5.5 0 0 0-1 0z" />
                        </svg> 課程管理</a></li>
                <li><a href="localhost:8080/MidtermAjaxMVC/lessons"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                            height="16" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                            <path
                                d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z" />
                            <path
                                d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z" />
                        </svg> 訂單管理</a></li>
                <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-emoji-frown" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                            <path
                                d="M4.285 12.433a.5.5 0 0 0 .683-.183A3.498 3.498 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.498 4.498 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683zM7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z" />
                        </svg> 檢舉案件管理</a></li>
                <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-heart" viewBox="0 0 16 16">
                            <path
                                d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z" />
                        </svg> 收藏管理</a></li>
                <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-star" viewBox="0 0 16 16">
                            <path
                                d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z" />
                        </svg> 評分管理</a></li>
            </ul>
        </div>
        <div class="main">
        <div class="container">
            <div class="favorite">
                <h2>課程管理</h2>
                <div class="favoriteTable">
                    <div class="favoriteTableHeader">
                        <h3>課程列表</h3>
                    </div>
                    <div>
                        請輸入課程ID : <input type="text" id="classid">
                        <input type="submit" id="selectbtn" value="送出">
                    </div>
                    <button type="submit" class="btn btn-light" id="selectAll">顯示全部</button>
                    <button type="submit" class="btn btn-light" id="insert" data-bs-toggle="modal"
                        data-bs-target="#insertModal">新增課程</button>
                    <div class="favoriteTableCon">
                        <table>
                            <thead>
                                <tr class="tableHead">
                                    <th>課程ID
                                    <th>老師ID
                                    <th>課程類別ID
                                    <th>課程介紹
                                    <th>課程名稱
                                    <th>課程內容
                                    <th>上課方式
                                    <th>價格
                                    <th>修改
                                    <th>刪除

                                </tr>
                            </thead>

                            <tbody id="tableList">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--刪除資料-->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">刪除資料</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    確定要刪除課程嗎 ?
                </div>
                <input type="text" id="deleteLesson" hidden="hidden" name="lessonlistid">
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="delbtn" data-bs-dismiss="modal">確定</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 更新資料 -->
    <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="updateModalLabel">修改</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <input type="text" id="updateLesson" hidden="hidden" name="">
                        <h4>單筆課程資料</h4>
                        <table>
                            <tr>
                                <th>老師ID
                                <td><input type="text" name="teacherid">
                            <tr>
                                <th>課程類別ID
                                <td><input type="text" name="classtypeid">
                            <tr>
                                <th>課程介紹
                                <td><input type="text" name="classcontent">
                            <tr>
                                <th>課程名稱
                                <td><input type="text" name="classname">
                            <tr>
                                <th>課程內容
                                <td><input type="text" name="classinfo">
                            <tr>
                                <th>上課方式
                                <td><input type="text" name="lessontype">
                            <tr>
                                <th>價格
                                <td><input type="text" name="price">
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="updatebtn">完成修改</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 新增資料 -->
    <div class="modal fade" id="insertModal" tabindex="-1" aria-labelledby="insertModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="insertModalLabel">新增課程</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div>
                        <h4>新增課程資料</h4>
                        <table>
                            <tr>
                                <th>老師ID
                                <td><input type="text" name="teacherid">
                            <tr>
                                <th>課程類別ID
                                <td><input type="text" name="classtypeid">
                            <tr>
                                <th>課程介紹
                                <td><input type="text" name="classcontent">
                            <tr>
                                <th>課程名稱
                                <td><input type="text" name="classname">
                            <tr>
                                <th>課程內容
                                <td><input type="text" name="classinfo">
                            <tr>
                                <th>上課方式
                                <td><input type="text" name="lessontype">
                            <tr>
                                <th>價格
                                <td><input type="text" name="price">
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="insertbtn">新增</button>
                </div>
            </div>
        </div>
    </div>



    <script>
    </script>
    <script>
        //jQuery 初始化
        $(function () {
            all()
            function all() {
                let str = ''
                $.ajax({
                    type: 'get',
                    url: 'lessons',
                    contentType: 'application/json',
                    success: function (data) {
                        for (let i = 0; i < data.length; i++) {
                            str += `<tr>
                         <td>${data[i].classid}</td>
                         <td>${data[i].teacherid}</td>
                         <td>${data[i].classtypeid}</td>
                         <td>${data[i].classcontent}</td>
                         <td>${data[i].classname}</td>
                         <td>${data[i].classinfo}</td>
                         <td>${data[i].lessontype}</td>
                         <td>${data[i].price}</td>
                         <td>
                            <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#updateModal"
                                onclick="prepareupdate('${data[i].classid}')">
                                修改</button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal"
                                onclick="prepareDelete('${data[i].classid}')">
                                刪除</button>
                                </td>
                                </tr>`
                        }
                        $("#tableList").html(str)
                    }
                })
            }
            //刪除單筆資料
            $('#delbtn').click(function () {
                let result = $('#deleteLesson').val();
                let str = ''
                console.log(result)
                $.ajax({
                    type: 'delete',
                    url: 'lessons/' + result,
                    dataType: 'text',
                    // contentType: 'application/json',
                    success(res) {
                        console.log(res)
                        setTimeout(all, 1000);
                    },
                    error(why) {

                    }

                })
            })

            //顯示全部資料
            $('#selectAll').click(function () {
                let str = ''
                $.ajax({
                    type: 'get',
                    url: 'lessons',
                    contentType: 'application/json',
                    success: function (data) {
                        for (let i = 0; i < data.length; i++) {
                            str += `<tr>
                         <td>${data[i].classid}</td>
                         <td>${data[i].teacherid}</td>
                         <td>${data[i].classtypeid}</td>
                         <td>${data[i].classcontent}</td>
                         <td>${data[i].classname}</td>
                         <td>${data[i].classinfo}</td>
                         <td>${data[i].lessontype}</td>
                         <td>${data[i].price}</td>
                         <td>
                            <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#updateModal"
                                onclick="prepareupdate('${data[i].classid}')">
                                修改</button>
                            <td>
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal"
                                onclick="prepareDelete('${data[i].classid}')">
                                刪除</button>
                                </td>
                     </tr>`
                        }
                        $("#tableList").html(str)
                    }
                })

            })

            //查詢單筆資料
            $('#selectbtn').click(function () {
                let result = $('#classid').val();
                console.log(result)
                let str = ''
                $.ajax({
                    type: 'get',
                    url: 'lessons/' + result,
                    contentType: 'application/json',
                    success: function (data) {
                        console.log();
                        str += `<tr>
                            <td>${data.classid}</td>
                            <td>${data.teacherid}</td>s
                            <td>${data.classtypeid}</td>
                            <td>${data.classcontent}</td>
                            <td>${data.classname}</td>
                            <td>${data.classinfo}</td>
                            <td>${data.lessontype}</td>
                            <td>${data.price}</td>
                            <td>
                                <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#updateModal"
                                onclick="prepareupdate('${data.classid}')">
                                修改</button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal"
                                onclick="prepareDelete('${data.classid}')">
                                刪除</button>
                            </td>
                                        </tr>`
                        console.log(str);
                        $('#tableList').html(str)
                    }

                })
            })

            //更新資料
            $('#updatebtn').click(function () {
                let result = $('#updateLesson').val();
                console.log(result)
                let teacherid = $('#updateModal input[name="teacherid"]').val()
                let classtypeid = $('#updateModal input[name="classtypeid"]').val()
                let classcontent = $('#updateModal input[name="classcontent"]').val()
                let classname = $('#updateModal input[name="classname"]').val()
                let classinfo = $('#updateModal input[name="classinfo"]').val()
                let lessontype = $('#updateModal input[name="lessontype"]').val()
                let price = $('#updateModal input[name="price"]').val()
                $.ajax({
                    type: 'put',
                    url: 'lessons/' + result + '?teacherID=' + teacherid + '&classTypeID=' + classtypeid + '&classContent=' + classcontent + '&className=' + classname + '&classInfo=' + classinfo + '&lessonType=' + lessontype + '&price=' + price,
                    contentType: 'application/json',
                    // data: {
                    //     teacherid: $('#updateModal input[name="teacherid"]').val(),
                    //     classtypeid: $('#updateModal input[name="classtypeid"]').val(),
                    //     classcontent: $('#updateModal input[name="classcontent"]').val(),
                    //     classname: $('#updateModal input[name="classname"]').val(),
                    //     classinfo: $('#updateModal input[name="classinfo"]').val(),
                    //     lessontype: $('#updateModal input[name="lessontype"]').val(),
                    //     price: $('#updateModal input[name="price"]').val()
                    // },
                    success(res) {
                        console.log(res)
                        setTimeout(all, 1000)
                    },
                    error(why) {
                        console.log(why)
                    }
                })

            })

            //新增資料
            $('#insertbtn').click(function () {
                let teacherid = $('#insertModal input[name="teacherid"]').val()
                let classtypeid = $('#insertModal input[name="classtypeid"]').val()
                let classcontent = $('#insertModal input[name="classcontent"]').val()
                let classname = $('#insertModal input[name="classname"]').val()
                let classinfo = $('#insertModal input[name="classinfo"]').val()
                let lessontype = $('#insertModal input[name="lessontype"]').val()
                let price = $('#insertModal input[name="price"]').val()
                $.ajax({
                    type: 'post',
                    url: 'lessons?teacherID=' + teacherid + '&classTypeID=' + classtypeid + '&classContent=' + classcontent + '&className=' + classname + '&classInfo=' + classinfo + '&lessonType=' + lessontype + '&price=' + price,
                    contentType: 'application/json',
                    success(res) {
                        console.log(res)
                        setTimeout(all, 1000)
                    },
                    error(why) {

                    }
                })
            })

        })
    </script>
    <script>
        function prepareDelete(classid) {
            let deleteLessonid = document.getElementById("deleteLesson")
            deleteLessonid.value = classid
        }

        function prepareupdate(classid) {
            $('#updateLesson').val(classid)
            console.log(classid);
            $.ajax({
                type: 'get',
                url: 'lessons/' + classid,
                contentType: 'application/json',
                success: function (res) {
                    console.log(res);
                    $('#updateModal input[name="teacherid"]').val(res.teacherid);
                    $('#updateModal input[name="classtypeid"]').val(res.classtypeid);
                    $('#updateModal input[name="classcontent"]').val(res.classcontent);
                    $('#updateModal input[name="classname"]').val(res.classname);
                    $('#updateModal input[name="classinfo"]').val(res.classinfo);
                    $('#updateModal input[name="lessontype"]').val(res.lessontype);
                    $('#updateModal input[name="price"]').val(res.price);

                    $('#updateModal').modal('show')
                }
            });
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.1/dist/umd/popper.min.js"
        integrity="sha384-W8fXfP3gkOKtndU4JGtKDvXbO53Wy8SZCQHczT5FMiiqmQfUpWbYdTil/SxwZgAN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js"
        integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/"
        crossorigin="anonymous"></script>

</body>

</html>